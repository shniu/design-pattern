
> 本篇文章为 libp2p specs 的中文翻译，以此来了解更多关于 libp2p 的详细内容。
> libp2p 项目地址：https://github.com/libp2p/specs

---

## 1. 介绍

在开发 IPFS 星际文件系统时，我们发现必须在具有不同网络设置和功能的异构设备上运行分布式文件系统所带来的几个挑战。在这个过程当中，我们不得不重新审视整个网络栈并制定解决方案，以克服多个层和协议的设计决策所带来的障碍，而不会破坏兼容性或重新创建技术。

为了构建这个库，我们专注于独立解决问题，使用强大的抽象创建不太复杂的解决方案，这些抽象在组合时可以为对等应用程序提供成功工作的环境。

### 1.1 动机

`libp2p` 是我们构建分布式系统集体经验的产物，因为将责任推给了开发者，让他们决定希望应用程序如何与网络中的其他人进行互操作，并且有利于配置和可扩展性，而不是对网络设置做出假设。

实质上，使用 `libp2p` 的节点应该能够和使用各种不同的传输协议的节点进行通信，包括连接中继，并且可以根据需要协商不同的协议。

### 1.2 目标

`libp2p` 规范和实现的目标是：

- 满足各种协议的使用：
  - 传输协议：TCP, UDP, SCTP, UDT, uTP, QUIC, SSH 等
  - 需要认证的传输协议：TLS, DTLS, CurveCP, SSH
  
- 有效利用套接字 (连接复用)
- 使对等体之间的通信能够通过一个套接字进行多路复用 (避免握手开销)
- 使用协商过程启用在多个对等体之间使用的多协议和相应版本
- 向后兼容
- 在当前系统中工作
- 使用当前网络的全部能力
- Have NAT traversal
- 启用连接中继
- 启用加密通道
- 有效利用底层传输（例如本机流复用，本机身份验证等）

## 2. 网络栈技术现状分析

本节向读者介绍网络堆栈的可用协议和体系结构的分析。 目标是提供推断结论的基础，并理解为什么 `libp2p` 具有它所具有的要求和架构。

### 2.1 C/S 模型

客户端 - 服务器模型表示信道两端的双方具有不同的角色，它们支持不同的服务和/或具有不同的能力，或者换句话说，它们拥有不同的协议。

构建客户端 - 服务器应用程序一直是出于以下原因的自然趋势：

- 数据中心内的带宽远远高于客户端可以相互连接的带宽
- 由于有效使用和大量库存，数据中心资源相当便宜
- 它使开发人员和系统管理员可以更轻松地对应用程序进行细粒度控制
- 它减少了要处理的异构系统的数量（尽管数量仍然很大）
- 像 NAT 这样的系统使得客户端很难找到并相互通信，迫使开发人员to perform very clever hacks来绕过这些障碍
- 开始设计协议时假设开发人员将从一开始就创建客户端 - 服务器应用程序

我们甚至学会了如何隐藏互联网上网关后面的分布式系统的所有复杂性，使用旨在执行点对点操作的协议，如 HTTP, 使得应用看到和理解每个请求产生的级联服务调用是不透明的。

`libp2p` 提供了从 C/S 监听向拨号监听交互的转变，其中不隐含哪些实体，拨号器或侦听器具有哪些功能或者能够执行哪些操作。今天在两个应用程序之间建立连接是一个需要解决的多层问题，这些连接不应该有目的偏差，而应该支持其他几个协议在已建立的连接之上工作。在客户端 - 服务器模型中，在没有来自客户端的先前请求的情况下发送数据的服务器被称为推送模型，这通常会增加更多的复杂性; 相比之下，在拨号器 - 侦听器模型中，两个实体都可以独立地执行请求。

### 2.2 按解决方案对网络堆栈协议进行分类

在深入研究 `libp2p` 协议之前，了解已广泛使用和部署的大量协议有助于维护当今简单的抽象。 例如，当人们考虑 HTTP 连接时，人们可能会天真地认为 HTTP / TCP / IP 是所涉及的主要协议，但实际上有更多协议参与，具体取决于使用情况，所涉及的网络等等。 DNS，DHCP，ARP，OSPF，Ethernet，802.11（Wi-Fi）等许多协议都涉及到。 展望互联网服务提供商自己的网络将会发现更多。

此外，值得注意的是传统的 7 层 OSI 模型表征不适合 `libp2p`。 相反，我们根据协议的角色对协议进行分类，即他们解决的问题。 OSI 模型的上层面向应用程序之间的点对点链接，而 libp2p 协议在各种不同的安全模型下更多地针对具有各种属性的各种大小的网络。 不同的 libp2p 协议可以具有相同的角色（在OSI模型中，这将是“寻址同一层”），这意味着多个协议可以同时运行，所有解决一个角色（而不是传统OSI中的每层协议）堆积）。 例如，引导列表，mDNS，DHT 发现和 PEX 都是角色“节点发现”的形式; 它们可以共存甚至协同作用。

#### 2.2.1 建立物理连接

- Ethernet
- Wi-Fi
- Bluetooth
- USB

#### 2.2.2 定位机器和进程

- IPv4
- IPv6
- Hidden addressing, like SDP

#### 2.2.3 发现节点或服务

- ARP
- DHCP
- DNS
- Onion

#### 2.2.4 通过网络路由消息

- RIP(1, 2)
- OSPF
- BGP
- PPP
- Tor
- I2P
- cjdns

#### 2.2.5 传输协议

- TCP
- UDP
- UDT
- QUIC
- WebRTC data channel

#### 2.2.6 应用程序相互通信的语义

- RMI
- Remoting
- RPC
- HTTP

### 2.3 目前的缺点

虽然我们目前有一整套可用于我们服务的协议进行通信，但丰富多样的解决方案会产生自己的问题。 目前，应用程序很难通过多种传输来支持和使用（例如，浏览器应用程序中缺少TCP / UDP堆栈）。

也没有“存在链接”，这意味着对等体没有在几个传输中宣布自己的概念，因此其他对等体可以保证它始终是同一个对等体。
