
## 2018 年第 40 周 (1015 ~ 1021)

### 架构演进 - 高可用高性能高可扩展

- [一篇文章，读懂Netty的高性能架构之道](https://mp.weixin.qq.com/s/H9oFI1jXGVP_Zk0U53M4VA)

// todo

- [数据库学习：高并发数据库设计](https://mp.weixin.qq.com/s/dqB9tAeLV6fz8vIdE3OWxA)

// todo

### 分布式技术

- [一致性模型](https://www.jianshu.com/p/3673e612cce2?from=singlemessage&isappinstalled=0)

// todo

- [Paxos和Raft的前世今生](https://mp.weixin.qq.com/s/OXE7prU9cMuZG8kFydPm9A)

**总结：** 在读另外一篇文章的时候，发现有谈论到 Paxos 和 Raft，就先来科补一下。

// todo

### Devops

- 总结梳理之前对 docker 的学习

// todo

### 服务化&微服务&虚拟化

- [揭秘：蚂蚁金服 SOFA 分布式架构演进之路](https://mp.weixin.qq.com/s/gTZzIDJNOVAz6JbSiAzuvQ)

**总结：** 花了中午一个小时左右的时间读完了，很不错的分享。详细的聊了蚂蚁系统架构的演进和方向，以及中间遇到的一些问题和应对策略。

1. 模块化

早起模块化是简单的分层，结合 Maven 的模块化支持（在代码的组织结构上进行了模块化的拆分，负责同一个功能的代码内聚到到一个 Maven 模块下面，最终打包成一个 JAR 包）；缺点是会导致模块和模块之间在运行时的高度耦合。

蚂蚁的解决办法是使用 JVM 级别的服务发布和引用，非常类似于 RPC 调用，但更加的轻量级，不需要跨网络，JVM 内部完成，具体的实现可以参考 [SOFA](https://github.com/alipay)。

这种模块化的方案解决了研发效率的问题，可以由多个团队同时对系统进行开发，在早期已经能满足发展了。

2. 服务化

业务量上来后，团队规模在变大，系统性能各方面要求升级，模块化慢慢转向服务化；服务化后一个重要的组件是服务注册中心，通过服务注册中心来管理大量服务之间的发现、路由等，需要保证服务注册中心的高可用性。

3. 数据拆分

原来，支付宝的所有的数据都在一个大的数据库里面，首先想到的就是进行垂直的拆分，将不同的业务的数据放到不同的数据库里面去。然后就是分库分表，按照用户id进行拆分，一些经验：`首先是最小的库的数量，可以通过业务峰值 TPS 除以单库容量上限 TPS 来计算。然后是最小的表的数量，可以通过单位时间业务量乘以存储时长再除以单表的容量上限来进行计算`。

4. 分布式事务和事务型消息

分布式事务采用 TCC，事务型消息采用二阶段提交。

分布式事务一般上用在强同步的场景，比如转账的场景，而事务型的消息一般上被用在异步的场景，比如消息记录的生成等

5. 合并部署和单元化

合并部署，就是将相关联的一些系统部署到一个 SOFA 运行时下面，每个系统之间通过单独的 ClassLoader 加载，防止出现类冲突，和服务化的过程刚好相反，在合并部署里面，SOFA 会自动地将这些系统之间的 RPC 调用转换成 JVM 调用，从而节省了类的成本。

在合并部署里面，有门面系统和非门面系统的概念，只有门面系统会对外暴露服务，外部的系统只能看到门面系统发布的服务，非门面的系统全部为门面系统服务。

在单元化中，一个逻辑数据中心只处理一个数据分片的请求，如果说数据是按照用户来进行分片的话，涉及到一个用户的请求只会在一个逻辑数据中心里面来处理，通过这样的设计，一个应用连的数据库只要和对应的逻辑数据中心的数据分片一致就可以，这样，就可以大量地减少数据库上的连接数的压力。而且利用这种逻辑数据中心的概念，理论上，如果数据库的连接数不足，只需要增加逻辑数据中心就可以。

6. 未来的路 ServiceMesh 微服务实践

提供多语言支持的架构升级，为更多业务需要做系统级改造，如机器学习的集成等。

- [干货 | 蚂蚁金服的业务系统模块化 -- 模块化隔离方案](https://mp.weixin.qq.com/s/M3bNIDNiFQBLs9QGpwVLsw)

// todo 优先处理

- [Introduction to Microservices](https://www.nginx.com/blog/introduction-to-microservices/)

// todo

- [Microservices Best Pratices for Java](https://www.redbooks.ibm.com/redbooks/pdfs/sg248357.pdf)

// todo

- [Microservices vs SOA](https://www.oreilly.com/programming/free/files/microservices-vs-service-oriented-architecture.pdf)

// todo

- [Microservices vs. SOA - DZone](https://dzone.com/articles/microservices-vs-soa-2)

// todo

- [nginx resources](https://www.nginx.com/resources/library/)

### 设计思想与编程范式

- [大话业务架构的演进](https://mp.weixin.qq.com/s/fxutc2cZ2BqMEvOv3joHaA)

**总结：** 实战型的思考文章，值得仔细读。作者分析了从一个简单架构一点点演进为复杂的架构，以满足不同时期的业务需要、性能、可用性等。首先，架构演进是业务驱动的，但又不局限于业务，在架构演进的过程中，系统性能以及稳定性等方面也需要考虑，其次，从上面的故事可以看出，架构设计其实就是对问题的划分和解决的过程，最后，架构也有好坏，由于业务的不确定性，架构往往需要演进，然而好的架构演进往往很容易，差的架构却很容易崩盘推倒重来，架构到底如何演进，非常考验一名架构师的功底。[原文出处](https://www.jianshu.com/u/4850c615df9d)

```
// 这里的分析很有借鉴意义

由于担心团队成员技术经验不够，独立设计系统可能会出问题，老王特地把各个系统的技术难点列出来，让每个技术团队回去思考实现方案，最后给出一份详细的技术方案。

1、物流订单中心

a)、需要在高并发环境下保证订单创建不重复

b)、需要在高并发环境下保证订单更新的原子性

c)、实现数据库分库分表，并实现全局ID生成机制

d)、在分库分表的基础上，需要满足买家视角、卖家视角的订单查询

e)、实现历史数据归档

f)、设计一套完整的状态机

g)、设计一套完整的消息

h)、保证订单状态变更和发送消息同时成功或者同时失败（分布式事务）

i)、定义一套合适的对外的接口以及数据模型

2、快递发货台

a)、设计一套抽象而又稳定的业务接口，同时支持不同的业务。也就是说，一个接口可以被新业务使用，而不是每个新业务都需要重新开一个接口。

b)、尽量做到业务流程可复用，而不是每个业务都是一条业务流程。

c)、保证前端安全，比如防止XSS攻击、CSRF攻击等

d)、保证接口安全，比如使用HTTPS保证传输安全、IP黑名单防止流量攻击等等

e)、保证数据安全，比如防止SQL注入

3、网关中心

a)、实现身份认证（HTTPS）

b)、实现权限管控

c)、实现日志审计，保存30日内的全量日志，随时可追溯

d)、自定义一套网关协议

e)、实现内部系统与外部系统之间的请求转发

f)、保证高并发环境下的系统性能和稳定性
```

- [十问 TiDB ：关于架构设计的一些思考](https://mp.weixin.qq.com/s/m2_Mf0-x_KpPHbnOawyy2A)

**总结：** 信息量很大，很多是自己目前不擅长的领域，但是文中对于做 TiDB 时所做的思考是非常宝贵的，其中的权衡和最终的选择是更宝贵的财富。

// todo 进度 50%

- [数据库事务隔离标准分析](https://mp.weixin.qq.com/s/kZRARy099VANRfJv21-G9Q)

// todo

### 前端生态

- [深度剖析：如何实现一个 Virtual DOM 算法](https://github.com/livoras/blog/issues/13)

// todo

### 技术管理和工程师文化

- [老板不在意你今天做了什么事](https://mp.weixin.qq.com/s/EP9orT00Y_3rtqAfXFhdsg)

**总结：** 这篇和上周一样也是和 OKR 有关的，作者用自己的理解来实践 OKR，发现了很多无效的行为。

你以这样简单而严格的要求去过每天，则这一天可以变得更好，也许没有那么舒服，但是绝对健康有收获。如果这样过好每一天，则可以过好每一周；过好每一周，则可以过好每一月；过好每一月，则可以过好每一年。过好每一年，则可以过好每一生。所有人都期待人生的成功与幸福，但是如果我们追根溯源，还是要回到每一天，回到每件事。当我们对待每件事的态度发生变化，哪怕只是这样微小的变化，我们的身心则正在产生积极的化学反应。

- [打碎自己、重建自己](https://mp.weixin.qq.com/s/a4Igv5sF98H4KoU_yhHS8Q)

// todo

- [你事业的上限究竟在哪里？|《哈佛商业评论》史上最佳文章](https://mp.weixin.qq.com/s/b7XDs82tNbCHxGmovbXc3w)

// todo

- [如何在团队建设工程师文化？阿里资深技术专家这么做](https://mp.weixin.qq.com/s/nqtb2rxZwLf6ISebujnDfQ)

// todo

### 大千世界 百家之言

- [P2P盛衰背后的金融逻辑](https://mp.weixin.qq.com/s/zK6V53W_ix2x_9CuU-oOqg)

// todo 总结
